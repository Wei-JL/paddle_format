# VOCæ•°æ®é›†å¤„ç†å·¥å…·ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

æœ¬å·¥å…·æä¾›äº†å®Œæ•´çš„VOCæ ¼å¼æ•°æ®é›†å¤„ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ•°æ®éªŒè¯ã€æ¸…æ´—ã€ç±»åˆ«ç­›é€‰ã€æ•°æ®é›†åˆ’åˆ†å’Œæ ¼å¼è½¬æ¢ç­‰ã€‚æ”¯æŒå¤šçº¿ç¨‹å¹¶å‘å¤„ç†ï¼Œå¤§å¹…æå‡å¤„ç†æ•ˆç‡ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. ç®€å•ä¸€é”®å¤„ç†

æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼æ˜¯ä½¿ç”¨ä¸€é”®å¤„ç†åŠŸèƒ½ï¼š

```python
from code.dataset_handler.voc_dataset import VOCDataset

# åˆå§‹åŒ–æ•°æ®é›†
dataset = VOCDataset(
    dataset_path="dataset/Fruit",  # æ•°æ®é›†è·¯å¾„
    train_ratio=0.8,               # è®­ç»ƒé›†æ¯”ä¾‹
    val_ratio=0.2,                 # éªŒè¯é›†æ¯”ä¾‹
    test_ratio=0.0,                # æµ‹è¯•é›†æ¯”ä¾‹
    max_workers=4                  # çº¿ç¨‹æ± å¤§å°
)

# ä¸€é”®å®Œæˆæ‰€æœ‰å¤„ç†
dataset.one_click_complete_conversion()
```

### 2. ç±»åˆ«ç­›é€‰å¤„ç†

æ”¯æŒä¸¤ç§ç±»åˆ«ç­›é€‰æ¨¡å¼ï¼š

#### æ’é™¤ä¸æƒ³è¦çš„ç±»åˆ«
```python
# æ’é™¤æŒ‡å®šç±»åˆ«
exclude_labels = ['banana', 'dragon fruit']
dataset.one_click_complete_conversion(exclude_labels=exclude_labels)
```

#### åªä¿ç•™æŒ‡å®šç±»åˆ«
```python
# åªä¿ç•™æŒ‡å®šç±»åˆ«
include_labels = ['pineapple', 'snake fruit']
dataset.one_click_complete_conversion(include_labels=include_labels)
```

## ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šç®€å•å¤„ç†ï¼ˆcode/use_code/simple_process_example.pyï¼‰

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ç®€å•çš„ä¸€é”®æ¸…æ´—+è½¬æ¢ä½¿ç”¨ç¤ºä¾‹
ä½¿ç”¨dataset/Fruitæ•°æ®é›†æ¼”ç¤ºå®Œæ•´çš„æ•°æ®å¤„ç†æµç¨‹
"""

import os
import sys

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
project_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
sys.path.insert(0, project_root)

from code.dataset_handler.voc_dataset import VOCDataset

def main():
    """ç®€å•çš„ä¸€é”®å¤„ç†ç¤ºä¾‹"""
    print("ğŸš€ å¼€å§‹ç®€å•çš„ä¸€é”®æ¸…æ´—+è½¬æ¢å¤„ç†...")
    
    # è®¾ç½®æ•°æ®é›†è·¯å¾„
    dataset_path = os.path.join(project_root, "dataset", "Fruit")
    
    # åˆå§‹åŒ–VOCæ•°æ®é›†å¤„ç†å™¨
    dataset = VOCDataset(
        dataset_path=dataset_path,
        train_ratio=0.8,      # è®­ç»ƒé›†æ¯”ä¾‹
        val_ratio=0.2,        # éªŒè¯é›†æ¯”ä¾‹
        test_ratio=0.0,       # æµ‹è¯•é›†æ¯”ä¾‹
        max_workers=4         # çº¿ç¨‹æ± å¤§å°
    )
    
    # æ‰§è¡Œä¸€é”®å®Œæ•´è½¬æ¢
    dataset.one_click_complete_conversion(skip_confirmation=True)
    
    print("ğŸ‰ å¤„ç†å®Œæˆï¼")

if __name__ == "__main__":
    main()
```

### ç¤ºä¾‹2ï¼šç±»åˆ«ç­›é€‰ï¼ˆcode/use_code/label_filtering_example.pyï¼‰

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
ç±»åˆ«ç­›é€‰ä½¿ç”¨ç¤ºä¾‹
æ¼”ç¤ºå¦‚ä½•ç­›é€‰æ‰ä¸æƒ³è¦çš„ç±»ï¼Œæˆ–è€…æŒ‡å®šæƒ³è¦çš„ç±»
"""

from code.dataset_handler.voc_dataset import VOCDataset

def example_exclude_labels():
    """ç¤ºä¾‹1: æ’é™¤ä¸æƒ³è¦çš„ç±»åˆ«"""
    dataset = VOCDataset(dataset_path="dataset/Fruit")
    
    # æ’é™¤ä¸æƒ³è¦çš„ç±»åˆ«
    exclude_labels = ['banana', 'dragon fruit']
    dataset.one_click_complete_conversion(
        exclude_labels=exclude_labels,
        skip_confirmation=True
    )

def example_include_labels():
    """ç¤ºä¾‹2: åªä¿ç•™æŒ‡å®šçš„ç±»åˆ«"""
    dataset = VOCDataset(dataset_path="dataset/Fruit")
    
    # åªä¿ç•™æŒ‡å®šçš„ç±»åˆ«
    include_labels = ['pineapple', 'snake fruit']
    dataset.one_click_complete_conversion(
        include_labels=include_labels,
        skip_confirmation=True
    )

if __name__ == "__main__":
    # è¿è¡Œç¤ºä¾‹
    example_include_labels()
```

## æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. æ•°æ®é›†åˆå§‹åŒ–

```python
dataset = VOCDataset(
    dataset_path="path/to/dataset",     # æ•°æ®é›†è·¯å¾„ï¼ˆå¿…éœ€ï¼‰
    train_ratio=0.85,                   # è®­ç»ƒé›†æ¯”ä¾‹ï¼ˆé»˜è®¤0.85ï¼‰
    val_ratio=0.15,                     # éªŒè¯é›†æ¯”ä¾‹ï¼ˆé»˜è®¤0.15ï¼‰
    test_ratio=0.0,                     # æµ‹è¯•é›†æ¯”ä¾‹ï¼ˆé»˜è®¤0.0ï¼‰
    max_workers=4,                      # çº¿ç¨‹æ± å¤§å°ï¼ˆé»˜è®¤4ï¼‰
    exclude_labels=None,                # æ’é™¤çš„ç±»åˆ«åˆ—è¡¨
    include_labels=None,                # åŒ…å«çš„ç±»åˆ«åˆ—è¡¨
    output_annotations_name=None        # è¾“å‡ºæ ‡æ³¨æ–‡ä»¶å¤¹åç§°
)
```

### 2. ä¸€é”®å¤„ç†åŠŸèƒ½

`one_click_complete_conversion()` æ–¹æ³•åŒ…å«ä»¥ä¸‹æ­¥éª¤ï¼š

1. **æ•°æ®éªŒè¯å’Œæ¸…æ´—**
   - éªŒè¯æ•°æ®é›†åŸºæœ¬ç»“æ„
   - å¹¶è¡ŒåŒ¹é…å›¾åƒå’Œæ ‡æ³¨æ–‡ä»¶
   - æ¸…ç†ç©ºæ ‡æ³¨æ–‡ä»¶
   - ç±»åˆ«ç­›é€‰ï¼ˆå¦‚æœæŒ‡å®šï¼‰

2. **å›¾åƒå°ºå¯¸æ£€æŸ¥å’Œä¿®æ­£**
   - å¹¶è¡Œæ£€æŸ¥å›¾åƒå°ºå¯¸ä¸€è‡´æ€§
   - è‡ªåŠ¨ä¿®æ­£XMLä¸­çš„å°ºå¯¸ä¿¡æ¯
   - è½¬æ¢å›¾åƒæ ¼å¼ï¼ˆå¦‚éœ€è¦ï¼‰

3. **æ•°æ®é›†åˆ’åˆ†**
   - æŒ‰æŒ‡å®šæ¯”ä¾‹åˆ’åˆ†è®­ç»ƒ/éªŒè¯/æµ‹è¯•é›†
   - ç”Ÿæˆåˆ’åˆ†æ–‡ä»¶ï¼ˆtrain.txt, val.txt, test.txt, trainval.txtï¼‰

4. **COCOæ ¼å¼è½¬æ¢**
   - è½¬æ¢ä¸ºCOCOæ ¼å¼JSONæ–‡ä»¶
   - æ”¯æŒPaddle3æ–°æ ¼å¼è¦æ±‚
   - åŒ…å«infoå’Œlicenseså­—æ®µ

### 3. ç±»åˆ«ç­›é€‰åŠŸèƒ½

#### æ’é™¤æ¨¡å¼ï¼ˆexclude_labelsï¼‰
```python
# æ’é™¤ä¸æƒ³è¦çš„ç±»åˆ«
exclude_labels = ['class1', 'class2']
dataset.one_click_complete_conversion(exclude_labels=exclude_labels)
```

#### åŒ…å«æ¨¡å¼ï¼ˆinclude_labelsï¼‰
```python
# åªä¿ç•™æŒ‡å®šç±»åˆ«
include_labels = ['class3', 'class4']
dataset.one_click_complete_conversion(include_labels=include_labels)
```

**æ³¨æ„**ï¼šexclude_labels å’Œ include_labels ä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚

### 4. è¾“å‡ºç»“æœ

å¤„ç†å®Œæˆåï¼Œä¼šåœ¨æ•°æ®é›†ç›®å½•ä¸‹ç”Ÿæˆï¼š

```
dataset/
â”œâ”€â”€ Annotations/              # åŸå§‹æ ‡æ³¨æ–‡ä»¶
â”œâ”€â”€ Annotations_clear/        # æ¸…æ´—åçš„æ ‡æ³¨æ–‡ä»¶
â”œâ”€â”€ JPEGImages/              # å›¾åƒæ–‡ä»¶
â”œâ”€â”€ ImageSets/
â”‚   â””â”€â”€ Main/
â”‚       â”œâ”€â”€ train.txt        # è®­ç»ƒé›†æ–‡ä»¶åˆ—è¡¨
â”‚       â”œâ”€â”€ val.txt          # éªŒè¯é›†æ–‡ä»¶åˆ—è¡¨
â”‚       â”œâ”€â”€ test.txt         # æµ‹è¯•é›†æ–‡ä»¶åˆ—è¡¨
â”‚       â”œâ”€â”€ trainval.txt     # è®­ç»ƒ+éªŒè¯é›†æ–‡ä»¶åˆ—è¡¨
â”‚       â””â”€â”€ labels.txt       # ç±»åˆ«æ ‡ç­¾æ–‡ä»¶
â”œâ”€â”€ train_coco.json          # è®­ç»ƒé›†COCOæ ¼å¼
â””â”€â”€ val_coco.json            # éªŒè¯é›†COCOæ ¼å¼
```

## é«˜çº§åŠŸèƒ½

### 1. å¤šçº¿ç¨‹å¹¶å‘å¤„ç†

å·¥å…·ä½¿ç”¨çº¿ç¨‹æ± å®ç°å¹¶å‘å¤„ç†ï¼Œå¤§å¹…æå‡å¤„ç†æ•ˆç‡ï¼š

```python
# è®¾ç½®æ›´å¤šå·¥ä½œçº¿ç¨‹
dataset = VOCDataset(
    dataset_path="path/to/dataset",
    max_workers=8  # å¢åŠ çº¿ç¨‹æ•°
)
```

### 2. XMLæ ¼å¼ä¿æŒ

å¤„ç†è¿‡ç¨‹ä¸­å®Œå…¨ä¿æŒXMLæ–‡ä»¶çš„åŸå§‹æ ¼å¼ï¼ˆç¼©è¿›ã€æ¢è¡Œç­‰ï¼‰ã€‚

### 3. ç‹¬ç«‹è¾“å‡ºç›®å½•

æ¸…æ´—åçš„æ–‡ä»¶ä¿å­˜åˆ°ç‹¬ç«‹ç›®å½•ï¼Œä¿æŠ¤åŸå§‹æ•°æ®ä¸è¢«ä¿®æ”¹ã€‚

### 4. è‡ªåŠ¨æ•°æ®é›†åç§°è·å–

ä»æ•°æ®é›†è·¯å¾„è‡ªåŠ¨è·å–æ•°æ®é›†åç§°ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®šã€‚

## é”™è¯¯å¤„ç†

å·¥å…·åŒ…å«å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼š

- è‡ªåŠ¨æ£€æµ‹å’Œä¿®å¤å›¾åƒå°ºå¯¸ä¸åŒ¹é…
- å¤„ç†æŸåçš„XMLæ–‡ä»¶
- éªŒè¯æ–‡ä»¶å®Œæ•´æ€§
- è¯¦ç»†çš„æ—¥å¿—è®°å½•

## æ€§èƒ½ä¼˜åŒ–

- å¤šçº¿ç¨‹å¹¶å‘å¤„ç†XMLæ–‡ä»¶
- æ‰¹é‡æ–‡ä»¶æ“ä½œ
- å†…å­˜ä¼˜åŒ–çš„å¤§æ–‡ä»¶å¤„ç†
- è¿›åº¦æ¡æ˜¾ç¤ºå¤„ç†çŠ¶æ€

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®å¤‡ä»½**ï¼šå¤„ç†å‰è¯·å¤‡ä»½åŸå§‹æ•°æ®é›†
2. **è·¯å¾„æ ¼å¼**ï¼šä½¿ç”¨æ­£æ–œæ æˆ–åæ–œæ éƒ½å¯ä»¥ï¼Œå·¥å…·ä¼šè‡ªåŠ¨å¤„ç†
3. **å†…å­˜ä½¿ç”¨**ï¼šå¤§æ•°æ®é›†å¤„ç†æ—¶æ³¨æ„å†…å­˜ä½¿ç”¨æƒ…å†µ
4. **çº¿ç¨‹æ•°é‡**ï¼šæ ¹æ®CPUæ ¸å¿ƒæ•°åˆç†è®¾ç½®çº¿ç¨‹æ± å¤§å°

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç†å¤§å‹æ•°æ®é›†ï¼Ÿ
A: å¢åŠ çº¿ç¨‹æ± å¤§å°ï¼Œä½¿ç”¨æ‰¹å¤„ç†æ¨¡å¼ï¼š
```python
dataset = VOCDataset(dataset_path="path", max_workers=8)
```

### Q: å¦‚ä½•åªå¤„ç†ç‰¹å®šç±»åˆ«ï¼Ÿ
A: ä½¿ç”¨include_labelså‚æ•°ï¼š
```python
dataset.one_click_complete_conversion(include_labels=['cat', 'dog'])
```

### Q: å¤„ç†åçš„æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ
A: æ¸…æ´—åçš„XMLæ–‡ä»¶åœ¨ `Annotations_clear` ç›®å½•ï¼ŒCOCOæ–‡ä»¶åœ¨æ•°æ®é›†æ ¹ç›®å½•ã€‚

### Q: å¦‚ä½•è·³è¿‡ç”¨æˆ·ç¡®è®¤ï¼Ÿ
A: ä½¿ç”¨skip_confirmationå‚æ•°ï¼š
```python
dataset.one_click_complete_conversion(skip_confirmation=True)